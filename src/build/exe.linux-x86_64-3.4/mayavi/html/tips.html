
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tips and Tricks &#8212; mayavi 4.6.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Miscellaneous" href="misc.html" />
    <link rel="prev" title="Building applications using Mayavi" href="building_applications.html" />
<style type="text/css">
  body {
    /* Very bottom copyright, etc. info */
    background: #4d598d;
  }

  .documentwrapper {
    /* Blank area on left bar */
    background: #24326e;
  }

  .related {
    /* Long horizontal nav bars */
    background: #3c4b8a!important;
  }

  .sphinxsidebarwrapper {
    /* Filled part of left sidebar */
    background: #24326e;
  }

  a {
    color: #253370;
  }

  .sphinxsidebarwrapper a {
    color: #f2f2f2!important;
  }
</style>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="misc.html" title="Miscellaneous"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="building_applications.html" title="Building applications using Mayavi"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mayavi 4.6.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tips-and-tricks">
<h1>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Permalink to this headline">¶</a></h1>
<p>Below are a few tips and tricks that you may find useful when you use
Mayavi2.</p>
<div class="section" id="using-mayavi-in-jupyter-notebooks">
<span id="jupyter-notebook"></span><h2>Using Mayavi in Jupyter notebooks<a class="headerlink" href="#using-mayavi-in-jupyter-notebooks" title="Permalink to this headline">¶</a></h2>
<p>Mayavi can display either images or <a class="reference external" href="http://www.x3dom.org">X3D</a> elements on the notebook.
The images are static and one cannot interact with them.  The X3D
output produces a fully interactive 3D scene.  For information on how
to interact with the scene, see here:
<a class="reference external" href="http://www.x3dom.org/documentation/interaction/">http://www.x3dom.org/documentation/interaction/</a></p>
<p>Mayavi ships with some javascript files that can be installed as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ jupyter nbextension install --py mayavi --user</span>
</pre></div>
</div>
<p>This will install the x3dom Javascript and CSS files locally.  Note
that you do not need to “enable” the extension or anything after you
run the above.  For more instructions and options see the
<a class="reference external" href="http://jupyter-notebook.readthedocs.io/en/latest/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html#Installation-of-Jupyter-Extensions">Installation of Jupyter Extensions</a>.  Doing this allows one to view
X3D files without a network connection.</p>
<p>To view Mayavi visualizations on the notebook one should first do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">mlab.init_notebook()</span>
</pre></div>
</div>
<p>Subequently, one may simply do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">s = mlab.test_plot3d()</span>
<span class="s2">s</span>
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">init_notebook</span></code> method is called it configures the Mayavi
objects so they can be rendered on the Jupyter notebook.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">One can call <code class="docutils literal notranslate"><span class="pre">init_notebook</span></code> multiple times if one wishes to
change the backend between <code class="docutils literal notranslate"><span class="pre">png</span></code> and <code class="docutils literal notranslate"><span class="pre">x3d</span></code> for some reason.</p>
</div>
<p>There are several optional arguments to <code class="docutils literal notranslate"><span class="pre">init_notebook</span></code>.</p>
<ul class="simple">
<li>The first is the backend which defaults to <code class="docutils literal notranslate"><span class="pre">'x3d'</span></code> and can also
be set to <code class="docutils literal notranslate"><span class="pre">'png'</span></code>.</li>
<li>One can set the pixel width and height of the figure to create
(as integers) (for example <code class="docutils literal notranslate"><span class="pre">mlab.init_notebook('x3d',800,800)</span></code>).</li>
<li>The last keyword argument <code class="docutils literal notranslate"><span class="pre">local</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
When <code class="docutils literal notranslate"><span class="pre">local=True</span></code> it uses javascript files that are distributed
along with Mayavi otherwise will require an internet connection
to use the x3dom files online.  If for some reason the installation
of the jupyter nbextension is not working, using <code class="docutils literal notranslate"><span class="pre">local=False</span></code>
with an internet connection should work on a modern browser that
supports WebGL.</li>
</ul>
<p>The X3D data is embedded in the notebook and can be shared but if the
scenes have a lot of polygons, these files can be large.  With the PNG
backend, the PNG’s are also embedded and these are smaller files.  The
PNG backend relies on offscreen rendering working correctly on your
platform.</p>
</div>
<div class="section" id="off-screen-rendering">
<span id="offscreen-rendering"></span><h2>Off screen rendering<a class="headerlink" href="#off-screen-rendering" title="Permalink to this headline">¶</a></h2>
<div class="section" id="avoiding-the-rendering-window">
<h3>Avoiding the rendering window<a class="headerlink" href="#avoiding-the-rendering-window" title="Permalink to this headline">¶</a></h3>
<p>Often you write Mayavi scripts to render a whole batch of images to make
an animation or so and find that each time you save an image, Mayavi
“raises” the window to make it the active window thus disrupting your
work.  This is needed since VTK internally grabs the window to make a
picture.  Occluding the window will also produce either blank or
incorrect images.</p>
<p>If you already have a Python script, say <code class="docutils literal notranslate"><span class="pre">script.py</span></code> that sets up your
visualization that you run likes so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -x script.py</span>
</pre></div>
</div>
<p>Then it is very easy to have this script run offscreen.  Simply run it
like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -x script.py -o</span>
</pre></div>
</div>
<p>This will run the script in an offscreen, standalone window.  On Linux,
this works best with VTK-5.2 and above.  For more details on the command
line arguments supported by the <code class="docutils literal notranslate"><span class="pre">mayavi2</span></code> application, see the
<a class="reference internal" href="application.html#command-line-arguments"><span class="std std-ref">Command line arguments</span></a> section.</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">mlab</span></code> you will want to do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">mlab.options.offscreen = True</span>
</pre></div>
</div>
<p>before you create a figure and it will use an offscreen window for the
rendering.</p>
<p>Another option for offscreen rendering would be to click on the scene
and set the “Off screen rendering” option on.  Or from a script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">mayavi.engine.current_scene.scene.off_screen_rendering = True</span>
</pre></div>
</div>
<p>This will stop raising the window.  However, this may not be enough.
Please see below on the situation on different platforms.</p>
</div>
<div class="section" id="platform-summary">
<h3>Platform Summary<a class="headerlink" href="#platform-summary" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><strong>Windows</strong>: If you are using win32 then off screen rendering should work
well out of the box.  All you will need to do is what is given above.</p>
</li>
<li><p class="first"><strong>Linux and the Mac</strong>: there are several options to get this working
correctly and some major issues to consider:</p>
<p>If you have VTK-5.2 the offscreen rendering option should let you
generate the pictures without worrying about occluding the window.
However, you will need VTK-5.2 to get this working properly.  There
are also situations when this does not always work – try it and if
you get blank windows, you have a problem.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">mlab.options.offscreen = True</span>
<span class="s2">mlab.test_contour3d()</span>
<span class="s2">mlab.savefig(&#39;example.png&#39;)</span>
</pre></div>
</div>
<p>If this produces a clean image (even if you switch desktops or cover
any windows produced), you should be golden.  If not you should
consider either using a virtual framebuffer or building VTK with Mesa
+ OSMesa to give you a pure software rendering approach.</p>
</li>
</ul>
</div>
<div class="section" id="rendering-using-the-virtual-framebuffer">
<h3>Rendering using the virtual framebuffer<a class="headerlink" href="#rendering-using-the-virtual-framebuffer" title="Permalink to this headline">¶</a></h3>
<p>VTK uses openGL for all its rendering. Under any conventional Unix
(including Linux), you need an Xserver running to open a GL context
(especially if you want hardware acceleration). This might be a problem
when rendering on a headless server. As mentioned in the above
paragraph, on a desktop, using the default server may also be a problem
as it interferes with your ongoing work.</p>
<p>A good workaround is to use the virtual framebuffer X server for X11 like
so:</p>
<blockquote>
<div><ul>
<li><p class="first">Make sure you have the <code class="docutils literal notranslate"><span class="pre">Xvfb</span></code> package installed.  For example
under Debian and derivatives this is called the <code class="docutils literal notranslate"><span class="pre">xvfb</span></code> package.</p>
</li>
<li><p class="first">Create the virtual framebuffer X server like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">Xvfb :1 -screen 0 1280x1024x24 -auth localhost</span>
</pre></div>
</div>
<p>This creates the display “:1” and creates a screen of size 1280x1024
with 24 bpp (the 24bpp is important).  For more options check your
<code class="docutils literal notranslate"><span class="pre">Xvfb</span></code> man page.</p>
</li>
<li><p class="first">Export display to :1 like so (on bash):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ export DISPLAY=:1</span>
</pre></div>
</div>
</li>
<li><p class="first">Now run your Mayavi script.  It should run uninterrupted on this X
server and produce your saved images.</p>
</li>
</ul>
</div></blockquote>
<p>This probably will have to be fine tuned to suit your taste.</p>
<p>Many Linux systems (including Ubuntu and Debian) ship with a helper
script <cite>xvfb-run</cite> for running headless. The following command can run a
Python script with Mayavi2 visualizations headless:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">xvfb-run --server-args=&quot;-screen 0 1024x768x24&quot; python my_script.py</span>
</pre></div>
</div>
<p>Beware that you shouldn’t call <cite>mlab.show</cite> or start the mainloop in the
script, elsewhere the script will run endlessly, waiting for interaction
in a hidden window.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you want to use Mayavi without the envisage UI or even a traits UI
(i.e. with a pure TVTK window) and do off screen rendering with
Python scripts you may be interested in the
<span class="xref std std-ref">examples_offscreen</span>. This simple example shows how you can use
Mayavi without using Envisage or the Mayavi envisage application and
still do off screen rendering.</p>
<p>If you are using mlab, outside of the Mayavi2 application, simply set:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">mlab.options.offscreen = True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-vtk-with-mesa-for-pure-software-rendering">
<h3>Using VTK with Mesa for pure software rendering<a class="headerlink" href="#using-vtk-with-mesa-for-pure-software-rendering" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you might want to run Mayavi/VTK completely headless on a
machine with no X server at all and are interested in pure offscreen
rendering (for example for usage on the <a class="reference external" href="http://www.sagemath.org">Sage</a> notebook interface).  In
these cases one could use Mesa’s OSMesa library to render offscreen.
The downside is that you will not get any hardware acceleration in this
case.  Here are brief instructions on how to build VTK to do this.</p>
<blockquote>
<div><ul>
<li><p class="first">Build a recent version of mesa.  7.0.4 (as of this time) should work
as would 7.2.  We assume you download MesaLib-7.0.4.tar.bz2.</p>
</li>
<li><p class="first">Untar, and change directory to the new directory created. We call
this directory <code class="docutils literal notranslate"><span class="pre">$MESA</span></code> henceforth.</p>
</li>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">configs/linux-x86</span></code>,  change file as per your
configuration. Run <code class="docutils literal notranslate"><span class="pre">make</span></code> to see list of options.  Note: 7.2 has a
<code class="docutils literal notranslate"><span class="pre">./configure</span></code> script that you can run.</p>
</li>
<li><p class="first">Get VTK-5.2 or later (CVS will also work)..</p>
</li>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">ccmake</span> <span class="pre">path/to/VTK</span></code>.</p>
<ul>
<li><p class="first">Now select advanced options ‘t’.</p>
</li>
<li><p class="first">Set <code class="docutils literal notranslate"><span class="pre">VTK_OPENGL_HAS_OSMESA</span> <span class="pre">ON</span></code></p>
</li>
<li><p class="first">Configure: press ‘c’</p>
</li>
<li><p class="first">Set the <code class="docutils literal notranslate"><span class="pre">OSMESA_INCLUDE_DIR</span></code> to the <code class="docutils literal notranslate"><span class="pre">$MESA/include</span> <span class="pre">dir</span></code></p>
</li>
<li><p class="first">Set <code class="docutils literal notranslate"><span class="pre">OSMESA_LIBRARY</span></code> to <code class="docutils literal notranslate"><span class="pre">$MESA/lib/libOSMesa.so</span></code></p>
</li>
<li><p class="first">Similarly set the <code class="docutils literal notranslate"><span class="pre">OPENGL_INCLUDE_DIR</span></code>,
<code class="docutils literal notranslate"><span class="pre">OPENGL_gl_LIBRARY=$MESA/lib/libGL.so</span></code>,
<code class="docutils literal notranslate"><span class="pre">OPENGL_glu_LIBRARY</span></code>, and <code class="docutils literal notranslate"><span class="pre">OPENGL_xmesa_INCLUDE_DIR</span></code>.</p>
</li>
<li><p class="first">Set <code class="docutils literal notranslate"><span class="pre">VTK_USE_OFFSCREEN</span></code> to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if you want offscreen all the
time, this will never produce an actual mapped VTK window since the
default value of the render window’s offscreen rendering ivar will
be set to True in this case.</p>
</li>
<li><p class="first">Any other settings like <code class="docutils literal notranslate"><span class="pre">VTK_USE_GL2PS,</span> <span class="pre">USE_RPATH</span></code> etc.</p>
</li>
<li><p class="first">Configure again (press ‘c’) and then generate ‘g’.</p>
</li>
<li><p class="first">Note that if you do not want to use <code class="docutils literal notranslate"><span class="pre">ccmake</span></code> and would like to do
this from the command line you may also do (for example):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">cmake </span><span class="se">\</span>
<span class="s2">-DVTK_OPENGL_HAS_OSMESA=ON </span><span class="se">\</span>
<span class="s2">-DVTK_USE_OFFSCREEN=ON </span><span class="se">\</span>
<span class="s2">-DCMAKE_INSTALL_PREFIX=/path/to/vtk-offscreen </span><span class="se">\</span>
<span class="s2">-DVTK_WRAP_PYTHON=ON </span><span class="se">\</span>
<span class="s2">-DPYTHON_EXECUTABLE=/usr/bin/python2.5 </span><span class="se">\</span>
<span class="s2">-DPYTHON_LIBRARY=/usr/lib/libpython2.5.so </span><span class="se">\</span>
<span class="s2">-DBUILD_SHARED_LIBS=ON </span><span class="se">\</span>
<span class="s2">-DVTK_USE_GL2PS=ON </span><span class="se">\</span>
<span class="s2">-DOSMESA_INCLUDE_DIR=/path/to/Mesa-7.2/include/ </span><span class="se">\</span>
<span class="s2">-DOSMESA_LIBRARY=/home/path/to/Mesa-7.2/lib64/libOSMesa.so </span><span class="se">\</span>
<span class="s2">-DOPENGL_INCLUDE_DIR=/path/to/Mesa-7.2/include </span><span class="se">\</span>
<span class="s2">-DOPENGL_gl_LIBRARY=/path/to/Mesa-7.2/lib64/libGL.so </span><span class="se">\</span>
<span class="s2">-DOPENGL_glu_LIBRARY=/path/to/Mesa-7.2/lib64/libGLU.so </span><span class="se">\</span>
<span class="s2">path/to/VTK/</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">make</span></code> and wait till VTK has built.  Let us say the build is in
<code class="docutils literal notranslate"><span class="pre">$VTK_BUILD</span></code>.</p>
</li>
<li><p class="first">Now install VTK or set the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> and <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>
suitably.  Also ensure that <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> points to
<code class="docutils literal notranslate"><span class="pre">$MESA/lib</span></code> (if the mesa libs are not installed on the system) this
ensures that VTK links to the right GL libs.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ export PYTHONPATH=$VTK_BUILD/bin:$VTK_BUILD/Wrapping/Python``</span>
<span class="s2">$ export LD_LIBRARY_PATH=$VTK_BUILD/bin:$MESA/lib</span>
</pre></div>
</div>
<p>Now, you should be all set.</p>
</li>
</ul>
</div></blockquote>
<p>Once this is done you should be able to run mlab examples offscreen.
This will work without an X display even.</p>
<p>With such a VTK built and running, one could simply build and install
mayavi2.  To use it in a Sage notebook for example you’d want to set
<code class="docutils literal notranslate"><span class="pre">ETS_TOOLKIT='null'</span></code> and set <code class="docutils literal notranslate"><span class="pre">mlab.options.offscreen</span> <span class="pre">=</span> <span class="pre">True</span></code>.  Thats
it.  Everything should now work offscreen.</p>
<p>Note that if you set <code class="docutils literal notranslate"><span class="pre">VTK_USE_OFFSCREEN</span></code> to <code class="docutils literal notranslate"><span class="pre">ON</span></code> then you’ll by
default only get offscreen contexts.  If you do want a UI you will want
to explicitly set the render window’s <code class="docutils literal notranslate"><span class="pre">off_screen_rendering</span></code> ivar to
<code class="docutils literal notranslate"><span class="pre">False</span></code> to force a mapped window.  For this reason if you might need
to popup a full UI, it might be better to <em>not set</em>
<code class="docutils literal notranslate"><span class="pre">VTK_USE_OFFSCREEN=ON</span></code>.</p>
</div>
</div>
<div class="section" id="extending-mayavi-with-customizations">
<h2>Extending Mayavi with customizations<a class="headerlink" href="#extending-mayavi-with-customizations" title="Permalink to this headline">¶</a></h2>
<p>A developer may wish to customize Mayavi by adding new sources, filters
or modules.  These can be done by writing the respective filters and
exposing them via a <code class="docutils literal notranslate"><span class="pre">user_mayavi.py</span></code> or a <code class="docutils literal notranslate"><span class="pre">site_mayavi.py</span></code> as
described in <a class="reference internal" href="#customizing-mayavi2">Customizing Mayavi2</a>.   A more flexible and
reusable mechanism for doing this is to create a full fledged Mayavi
contrib package in the following manner.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Create a Python package, let’s call it <code class="docutils literal notranslate"><span class="pre">mv_iitb</span></code> (for IIT Bombay
specific extensions/customizations).  The directory structure of
this package can be something like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">mv_iitb/</span>
<span class="s2">        __init__.py</span>
<span class="s2">        user_mayavi.py</span>
<span class="s2">        sources/</span>
<span class="s2">                ...</span>
<span class="s2">        filters/</span>
<span class="s2">                ...</span>
<span class="s2">        modules/</span>
<span class="s2">                ...</span>
<span class="s2">        docs/</span>
<span class="s2">            ...</span>
</pre></div>
</div>
<p>The two key points to note in the above are the fact that
<code class="docutils literal notranslate"><span class="pre">mv_iitb</span></code> is a proper Python package (notice the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>)
and the <code class="docutils literal notranslate"><span class="pre">user_mayavi.py</span></code> is the file that adds whatever new
sources/filters/modules etc. to Mayavi.  The other part of the
structure is really up to the developer.  At the moment these
packages can add new sources, filters, modules and contribute any
Envisage plugins that the <code class="docutils literal notranslate"><span class="pre">mayavi2</span></code> application will load.</p>
</li>
<li><p class="first">This package should then be installed somewhere on <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>.
Once this is done, users can find these packages and enable them
from the Tools-&gt;Preferences (the UI will automatically detect the
package).  The <code class="docutils literal notranslate"><span class="pre">user_mayavi.py</span></code> of each selected package will
then be imported next time Mayavi is started, note that this will
be usable even from <code class="docutils literal notranslate"><span class="pre">mlab</span></code>.</p>
</li>
</ol>
</div></blockquote>
<p>Any number of such packages may be created and distributed.  If they are
installed, users can choose to enable them.  Internally, the list of
selected packages is stored as the <code class="docutils literal notranslate"><span class="pre">mayavi.contrib_packages</span></code>
preference option.  The following code shows how this may be accessed
from a Python script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mayavi.preferences.api</span> <span class="k">import</span> <span class="n">preference_manager</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">preference_manager</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">contrib_packages</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">preference_manager</span><span class="o">.</span><span class="n">configure_traits</span><span class="p">()</span> <span class="c1"># Pop up a UI.</span>
</pre></div>
</div>
<p>For more details on how best to write <code class="docutils literal notranslate"><span class="pre">user_mayavi.py</span></code> files and what
you can do in them, please refer to the
<a class="reference external" href="https://raw.githubusercontent.com/enthought/mayavi/4.4.4/examples/mayavi/user_mayavi.py">examples/mayavi/user_mayavi.py</a> example.  Please pay particular
attention to the warnings in that file.  It is a very good idea to
ensure that the <code class="docutils literal notranslate"><span class="pre">user_mayavi.py</span></code> does not implement any
sources/modules/filters and only registers the metadata.  This will
avoid issues with circular imports.</p>
</div>
<div class="section" id="customizing-mayavi2">
<h2>Customizing Mayavi2<a class="headerlink" href="#customizing-mayavi2" title="Permalink to this headline">¶</a></h2>
<p>There are three ways a user can customize Mayavi:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Via Mayavi contributions installed on the system.  This may be done
by enabling any found contributions from the Tools-&gt;Preferences
menu on the Mayavi component, look for the “contribution settings”.
Any selected contributions will be imported the next time Mayavi
starts.  For more details see the <a class="reference internal" href="#extending-mayavi-with-customizations">Extending Mayavi with
customizations</a> section.</li>
<li>At a global, system wide level via a <code class="docutils literal notranslate"><span class="pre">site_mayavi.py</span></code>.  This file
is to be placed anywhere on <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>.</li>
<li>At a local, user level.  This is achieved by placing a
<code class="docutils literal notranslate"><span class="pre">user_mayavi.py</span></code> in the users <code class="docutils literal notranslate"><span class="pre">~/.mayavi2/</span></code> directory.  If a
<code class="docutils literal notranslate"><span class="pre">~/.mayavi2/user_mayavi.py</span></code> is found, the directory is placed in
<code class="docutils literal notranslate"><span class="pre">sys.path</span></code>.</li>
</ol>
</div></blockquote>
<p>The files are similar in their content.  Two things may be done in this
file:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Registering new sources, modules or filters in the Mayavi registry
(<code class="docutils literal notranslate"><span class="pre">mayavi.core.registry.registry</span></code>).  This is done by
registering metadata for the new class in the registry.  See
<code class="docutils literal notranslate"><span class="pre">examples/mayavi/user_mayavi.py</span></code> to see an example.</li>
<li>Adding additional envisage plugins to the mayavi2 application.
This is done by defining a function called <code class="docutils literal notranslate"><span class="pre">get_plugins()</span></code> that
returns a list of plugins that you wish to add to the mayavi2
application.</li>
</ol>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">examples/mayavi/user_mayavi.py</span></code> example documents and shows how
this can be done.  To see it, copy the file to the <code class="docutils literal notranslate"><span class="pre">~/.mayavi2</span></code>
directory.  If you are unsure where <code class="docutils literal notranslate"><span class="pre">~</span></code> is on your platform, just run
the example and it should print out the directory.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In the <code class="docutils literal notranslate"><span class="pre">user_mayavi.py</span></code> or <code class="docutils literal notranslate"><span class="pre">site_mayavi.py</span></code>, avoid Mayavi imports
like  <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">mayavi.modules.outline</span> <span class="pre">import</span> <span class="pre">Outline</span></code> etc.
This is because <code class="docutils literal notranslate"><span class="pre">user_mayavi</span></code> is imported at a time when many of the
imports are not complete and this will cause hard-to-debug circular
import problems.  The <code class="docutils literal notranslate"><span class="pre">registry</span></code> is given only metadata mostly in the
form of strings and this will cause no problem.  Therefore to define
new modules, we strongly recommend that the modules be defined in
another module or be defined in a factory function as done in the
example <code class="docutils literal notranslate"><span class="pre">user_mayavi.py</span></code> provided.</p>
</div>
</div>
<div class="section" id="scripting-mayavi-without-using-envisage">
<h2>Scripting Mayavi without using Envisage<a class="headerlink" href="#scripting-mayavi-without-using-envisage" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="auto/example_standalone.html#example-standalone"><span class="std std-ref">Standalone example</span></a> demonstrates how one can use the core
Mayavi API without using Envisage.  This is useful when you want to
minimize dependencies.  <a class="reference internal" href="auto/example_offscreen.html#example-offscreen"><span class="std std-ref">Offscreen example</span></a> demonstrates how to use
Mayavi without the envisage UI or even a traits UI (i.e. with a pure TVTK
window) and do off screen rendering.</p>
</div>
<div class="section" id="computing-in-a-thread">
<h2>Computing in a thread<a class="headerlink" href="#computing-in-a-thread" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="auto/example_compute_in_thread.html#example-compute-in-thread"><span class="std std-ref">Compute in thread example</span></a> demonstrates how to visualize a 2D
numpy array and visualize it as image data using a few modules.  It also
shows how one can do a computation in another thread and update the
Mayavi pipeline once the computation is done.  This allows a user to
interact with  the user interface when the computation is performed in
another thread.</p>
</div>
<div class="section" id="polling-a-file-and-auto-updating-mayavi">
<h2>Polling a file and auto-updating Mayavi<a class="headerlink" href="#polling-a-file-and-auto-updating-mayavi" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you have a separate computational process that generates data
suitable for visualization.  You’d like Mayavi to visualize the data but
automatically update the data when the data file is updated by the
computation.  This is easily achieved by polling the data file and
checking if it has been modified.  The <a class="reference internal" href="auto/example_poll_file.html#example-poll-file"><span class="std std-ref">Poll file example</span></a>
demonstrates this.  To see it in action will require that you edit the
scalar data in the <code class="docutils literal notranslate"><span class="pre">examples/data/heart.vtk</span></code> data file.</p>
</div>
<div class="section" id="serving-mayavi-on-the-network">
<h2>Serving Mayavi on the network<a class="headerlink" href="#serving-mayavi-on-the-network" title="Permalink to this headline">¶</a></h2>
<p>Say you have a little visualization script and you’d like to run some
kind of server where you can script the running Mayavi UI from a TCP/UDP
connection.  It turns out there is a simple way to do this  if you have
<a class="reference external" href="http://www.twistedmatrix.com">Twisted</a> installed.  Here is a trivial example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">from mayavi.tools import server</span>
<span class="s2">mlab.test_plot3d()</span>
<span class="s2">server.serve_tcp()</span>
</pre></div>
</div>
<p>There is no need to call <code class="docutils literal notranslate"><span class="pre">mlab.show()</span></code> in the above.  The TCP server
will listen on port 8007 by default in the above (this can be changed
with suitable arguments to <code class="xref py py-func docutils literal notranslate"><span class="pre">serve_tcp()</span></code>).  Any data sent to the server
is simply exec’d, meaning you can do pretty much anything you want.  The
names <code class="docutils literal notranslate"><span class="pre">engine</span></code>, <code class="docutils literal notranslate"><span class="pre">scene</span></code>, <code class="docutils literal notranslate"><span class="pre">camera</span></code> and <code class="docutils literal notranslate"><span class="pre">mlab</span></code> are all available
and can be scripted with Python code.  For example after running the
above you can do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ telnet localhost 8007</span>
<span class="s2">Trying 127.0.0.1...</span>
<span class="s2">Connected to localhost.</span>
<span class="s2">Escape character is &#39;^]&#39;.</span>
<span class="s2">scene.camera.azimuth(45)</span>
<span class="s2">mlab.clf()</span>
<span class="s2">mlab.test_contour3d()</span>
<span class="s2">scene.camera.zoom(1.5)</span>
</pre></div>
</div>
<p>The nice thing about this is that you do not loose any interactivity of
the application and can continue to use its UI as before, any network
commands will be simply run on top of this.  To serve on a UDP port use
the <code class="xref py py-func docutils literal notranslate"><span class="pre">serve_udp()</span></code> function.  For more details on the <code class="docutils literal notranslate"><span class="pre">server</span></code> module
please look at the source code – it is thoroughly documented.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">While this is very powerful it is also a huge security hole
since the remote user can do pretty much anything they want once
connected to the server.</p>
</div>
<div class="section" id="tcp-server-the-serve-tcp-function">
<h3>TCP server: the <cite>serve_tcp</cite> function<a class="headerlink" href="#tcp-server-the-serve-tcp-function" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="udp-server-the-serve-udp-function">
<h3>UDP server: the <cite>serve_udp</cite> function<a class="headerlink" href="#udp-server-the-serve-udp-function" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="animating-a-timeseries">
<span id="id1"></span><h2>Animating a timeseries<a class="headerlink" href="#animating-a-timeseries" title="Permalink to this headline">¶</a></h2>
<p>If a file that mayavi can load has the form <code class="docutils literal notranslate"><span class="pre">some_name[0-9]*.ext</span></code>,
then it is treated as part of a timeseries.  For example let us say
you have the following files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ls
data_01.vti data_02.vti ... data_10.vti
</pre></div>
</div>
<p>If one loads the file using Mayavi, a slider will show up on the file
reader object which can be used to choose an appropriate timestep.
There are also buttons to automatically change the timestep. To do
this, select the play checkbox.  This can also be done
programmatically as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">src = mlab.pipeline.open(&#39;data_01.vti&#39;)</span>
<span class="s2">src.play = True</span>
</pre></div>
</div>
<p>Selecting the “loop” checkbox will loop over the files continuously.
If you have multiple files that are part of a timeseries, you can
choose the “sync timestep” option.  This will sync all the timesteps
of the other files that have the same number of timesteps as the
current reader. The “Rescan files” button will rescan the files on the
disc to find newer ones that are part of the timeseries.</p>
</div>
<div class="section" id="animating-a-visualization">
<span id="id2"></span><h2>Animating a visualization<a class="headerlink" href="#animating-a-visualization" title="Permalink to this headline">¶</a></h2>
<p>Often users like to animate visualization without affecting the
interactive capabilities of the view.  For example you may want to
rotate the camera continuously, take a snapshot while continuing to
interact with the Mayavi UI.  To do this one can use the very convenient
<a class="reference internal" href="auto/mlab_other_functions.html#mayavi.mlab.animate" title="mayavi.mlab.animate"><code class="xref py py-func docutils literal notranslate"><span class="pre">animate()</span></code></a> decorator provided with Mayavi.  Here is a simple
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">@mlab.animate</span>
<span class="s2">def anim():</span>
<span class="s2">    f = mlab.gcf()</span>
<span class="s2">    while 1:</span>
<span class="s2">        f.scene.camera.azimuth(10)</span>
<span class="s2">        f.scene.render()</span>
<span class="s2">        yield</span>

<span class="s2">a = anim() # Starts the animation.</span>
</pre></div>
</div>
<p>Notice the use of <code class="docutils literal notranslate"><span class="pre">yield</span></code> in the above, this is <em>very</em> crucial to this
working.  This example will continuously rotate the camera without
affecting the UI’s interactivity.  It also pops up a little UI that lets
you start and stop the animation and change the time interval between
calls to your function.  For more specialized use you can pass arguments
to the decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">@mlab.animate(delay=500, ui=False)</span>
<span class="s2">def anim():</span>
<span class="s2">    # ...</span>

<span class="s2">a = anim() # Starts the animation without a UI.</span>
</pre></div>
</div>
<p>If you don’t want to import all of <code class="docutils literal notranslate"><span class="pre">mlab</span></code>, the animate
decorator is available from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi.tools.animator import animate</span>
</pre></div>
</div>
<p>Note that to start the event loop, <em>i.e.</em> to get the animation running,
you will need to call <a class="reference internal" href="auto/mlab_other_functions.html#mayavi.mlab.show" title="mayavi.mlab.show"><code class="xref py py-func docutils literal notranslate"><span class="pre">show()</span></code></a> if you do not already have a GUI
environment running.</p>
<p>Here is another example illustrating the use of the decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">import numpy as np</span>
<span class="s2">from mayavi import mlab</span>

<span class="s2">@mlab.animate(delay = 100)</span>
<span class="s2">def updateAnimation():</span>
<span class="s2">    t = 0.0</span>
<span class="s2">    while True:</span>
<span class="s2">        ball.mlab_source.set(x = np.cos(t), y = np.sin(t), z = 0)</span>
<span class="s2">        t += 0.1</span>
<span class="s2">        yield</span>

<span class="s2">ball = mlab.points3d(np.array(1.), np.array(0.), np.array(0.))</span>

<span class="s2">updateAnimation()</span>
<span class="s2">mlab.show()</span>
</pre></div>
</div>
<p>For more details check the documentation of the <a class="reference internal" href="auto/mlab_other_functions.html#mayavi.mlab.animate" title="mayavi.mlab.animate"><code class="xref py py-func docutils literal notranslate"><span class="pre">animate()</span></code></a> decorator
available in the <a class="reference internal" href="auto/mlab_reference.html#mlab-reference"><span class="std std-ref">MLab reference</span></a>. For an example using it,
alongside with the <cite>visual</cite> handy for object-movement animation, see
<a class="reference internal" href="auto/example_mlab_visual.html#example-mlab-visual"><span class="std std-ref">Mlab visual example</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to change the data of an object in an animation, see
<a class="reference internal" href="mlab_animating.html#mlab-animating-data"><span class="std std-ref">Animating the data</span></a></p>
</div>
<div class="section" id="creating-a-movie-from-an-animation">
<h3>Creating a movie from an animation<a class="headerlink" href="#creating-a-movie-from-an-animation" title="Permalink to this headline">¶</a></h3>
<p>It is easy to create a movie from either an animation or by playing a
timeseries.  To do this on the UI, select the Mayavi Scene and
navigate to the Movie tab and select the record checkbox.  After this,
if one animates a timestep via the “play” checkbox referred to in
<a class="reference internal" href="#animating-a-timeseries"><span class="std std-ref">Animating a timeseries</span></a>, then a stack of images will be created
in the directory specified in the movie UI.  This will also happen if
one runs an animation as discussed in <a class="reference internal" href="#animating-a-visualization"><span class="std std-ref">Animating a visualization</span></a>.</p>
<p>This can also be scripted with mlab for example as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">f = mlab.figure()</span>
<span class="s2">f.scene.movie_maker.record = True</span>
<span class="s2">mlab.test_mesh_sphere_anim()</span>
</pre></div>
</div>
<p>This will create a set of images, one for each step of the animation.
The <code class="docutils literal notranslate"><span class="pre">movie_maker</span></code> instance is available on each created scene.</p>
</div>
<div class="section" id="animating-a-series-of-images">
<h3>Animating a series of images<a class="headerlink" href="#animating-a-series-of-images" title="Permalink to this headline">¶</a></h3>
<p>Let’s say you have a stack of PNG or JPEG files that are numbered
serially that you want to animate on a Mayavi scene.  Here is a simple
script (called <code class="docutils literal notranslate"><span class="pre">img_movie.py</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2"># img_movie.py</span>
<span class="s2">from pyface.timer.api import Timer</span>

<span class="s2">def animate(src, N=10):</span>
<span class="s2">    for j in range(N):</span>
<span class="s2">        for i in range(len(src.file_list)):</span>
<span class="s2">            src.timestep = i</span>
<span class="s2">            yield</span>

<span class="s2">if __name__ == &#39;__main__&#39;:</span>
<span class="s2">    src = mayavi.engine.scenes[0].children[0]</span>
<span class="s2">    animator = animate(src)</span>
<span class="s2">    t = Timer(250, animator.next)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Timer</span></code> class lets you call a function without blocking the
running user interface.  The first argument is the time after which the
function is to be called again in milliseconds.  The <code class="docutils literal notranslate"><span class="pre">animate</span></code>
function is a generator and changes the timestep of the source.  This
script will animate the stack of images 10 times.  The script animates
the first data source by default.  This may be changed easily.</p>
<p>To use this script do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -d your_image000.png -m ImageActor -x img_movie.py</span>
</pre></div>
</div>
</div>
<div class="section" id="making-movies-from-a-stack-of-images">
<h3>Making movies from a stack of images<a class="headerlink" href="#making-movies-from-a-stack-of-images" title="Permalink to this headline">¶</a></h3>
<p>This isn’t really related to Mayavi but is a useful trick nonetheless.
Let’s say you generate a stack of images using Mayavi say of the form
<code class="docutils literal notranslate"><span class="pre">anim%03d.png</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">anim000.png</span></code>, <code class="docutils literal notranslate"><span class="pre">anim001.png</span></code> and so on), you
can make this into a movie.  If you have <code class="docutils literal notranslate"><span class="pre">mencoder</span></code> installed try
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mencoder &quot;mf://anim</span><span class="si">%03d</span><span class="s2">.png&quot; -mf fps=10 -o anim.avi </span><span class="se">\</span>
<span class="s2">  -ovc lavc -lavcopts vcodec=msmpeg4v2:vbitrate=500</span>
</pre></div>
</div>
<p>If you have ffmpeg installed you may try this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ ffmpeg -f image2 -r 10 -i anim</span><span class="si">%03d</span><span class="s2">.png -sameq anim.mov -pass 2</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="scripting-from-the-command-line">
<h2>Scripting from the command line<a class="headerlink" href="#scripting-from-the-command-line" title="Permalink to this headline">¶</a></h2>
<p>The Mayavi application allows for very powerful
<a class="reference internal" href="application.html#command-line-arguments"><span class="std std-ref">Command line arguments</span></a> that lets you build a complex
visualization from your shell.  What follow is a bunch of simple
examples illustrating these.</p>
<p>The following example creates a <code class="docutils literal notranslate"><span class="pre">ParametricSurface</span></code> source and then
visualizes glyphs on its surface colored red:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -d ParametricSurface -m Glyph </span><span class="se">\</span>
<span class="s2">-s&quot;glyph.glyph.scale_factor=0.1&quot; </span><span class="se">\</span>
<span class="s2">-s&quot;glyph.color_mode=&#39;no_coloring&#39;&quot; </span><span class="se">\</span>
<span class="s2">-s&quot;actor.property.color = (1,0,0)&quot;</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">-s&quot;string&quot;</span></code> applies the string on the last object (also
available as <code class="docutils literal notranslate"><span class="pre">last_obj</span></code>), which is the glyph.</p>
<p>This example turns off coloring of the glyph and changes the glyph to
display:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -d ParametricSurface -m Glyph</span><span class="se">\</span>
<span class="s2">-s&quot;glyph.glyph.scale_factor=0.1&quot; </span><span class="se">\</span>
<span class="s2">-s&quot;glyph.color_mode=&#39;no_coloring&#39;&quot; </span><span class="se">\</span>
<span class="s2">-s&quot;glyph.glyph_source.glyph_source = last_obj.glyph.glyph_source.glyph_list[-1]&quot;</span>
</pre></div>
</div>
<p>Note the use of <code class="docutils literal notranslate"><span class="pre">last_obj</span></code> in the above.</p>
</div>
<div class="section" id="texture-mapping-actors">
<h2>Texture mapping actors<a class="headerlink" href="#texture-mapping-actors" title="Permalink to this headline">¶</a></h2>
<p>Here is a simple example showing how to texture map an iso-surface with
the data that ships with the Mayavi sources (the data files are in the
examples directory):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -d examples/tvtk/images/masonry.jpg </span><span class="se">\</span>
<span class="s2"> -d examples/mayavi/data/heart.vti </span><span class="se">\</span>
<span class="s2"> -m IsoSurface </span><span class="se">\</span>
<span class="s2"> -s&quot;actor.mapper.scalar_visibility=False&quot; </span><span class="se">\</span>
<span class="s2"> -s&quot;actor.enable_texture=True&quot;</span><span class="se">\</span>
<span class="s2"> -s&quot;actor.tcoord_generator_mode=&#39;cylinder&#39;&quot;</span><span class="se">\</span>
<span class="s2"> -s&quot;actor.texture_source_object=script.engine.current_scene.children[0]&quot;</span>
</pre></div>
</div>
<p>It should be relatively straightforward to change this example to use a
<code class="docutils literal notranslate"><span class="pre">ParametricSurface</span></code> instead and any other image of your choice.
Notice how the texture image (<code class="docutils literal notranslate"><span class="pre">masonry.jpg</span></code>) is set in the last line
of the above.  The image reader is the first child of the current scene
and we set it as the <code class="docutils literal notranslate"><span class="pre">texture_source_object</span></code> of the isosurface actor.</p>
</div>
<div class="section" id="shifting-data-and-plotting">
<h2>Shifting data and plotting<a class="headerlink" href="#shifting-data-and-plotting" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you need to shift/transform your input data in space and
visualize that in addition to the original data.  This is useful when
you’d like to do different things to the same data and see them on the
same plot.  This can be done with Mayavi using the <code class="docutils literal notranslate"><span class="pre">TransformData</span></code> filter
for <code class="docutils literal notranslate"><span class="pre">StructuredGrid</span></code>, <code class="docutils literal notranslate"><span class="pre">PolyData</span></code> and <code class="docutils literal notranslate"><span class="pre">UnstructuredGrid</span></code> datasets.
Here is an example using the <code class="docutils literal notranslate"><span class="pre">ParametricSurface</span></code> data source:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -d ParametricSurface </span><span class="se">\</span>
<span class="s2">  -m Outline -m Surface </span><span class="se">\</span>
<span class="s2">  -f TransformData -s &quot;transform.translate(1,1,1)&quot; </span><span class="se">\</span>
<span class="s2">  -s &quot;widget.set_transform(last_obj.transform)&quot; </span><span class="se">\</span>
<span class="s2">  -m Outline -m Surface</span>
</pre></div>
</div>
<p>If you have an <code class="docutils literal notranslate"><span class="pre">ImageData</span></code> dataset then you can change the origin,
spacing and extents alone by using the <code class="docutils literal notranslate"><span class="pre">ImageChangeInformation</span></code>
filter.  Here is a simple example with the standard Mayavi image data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -d examples/mayavi/data/heart.vti -m Outline </span><span class="se">\</span>
<span class="s2">-m ImagePlaneWidget </span><span class="se">\</span>
<span class="s2">-f ImageChangeInformation </span><span class="se">\</span>
<span class="s2">-s &quot;filter.origin_translation=(20,20,20)&quot; </span><span class="se">\</span>
<span class="s2">-m Outline -m ImagePlaneWidget</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-userdefined-filter">
<span id="using-userdefined-filter"></span><h2>Using the <code class="docutils literal notranslate"><span class="pre">UserDefined</span></code> filter<a class="headerlink" href="#using-the-userdefined-filter" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">UserDefined</span></code> filter in Mayavi lets you wrap around existing VTK
filters easily.  Here are a few examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">$ mayavi2 -d ParametricSurface -s &quot;function=&#39;dini&#39;&quot; </span><span class="se">\</span>
<span class="s2">-f UserDefined:GeometryFilter </span><span class="se">\</span>
<span class="s2">-s &quot;filter.extent_clipping=True&quot; </span><span class="se">\</span>
<span class="s2">-s &quot;filter.extent = [-1,1,-1,1,0,5]&quot; </span><span class="se">\</span>
<span class="s2">-f UserDefined:CleanPolyData </span><span class="se">\</span>
<span class="s2">-m Surface </span><span class="se">\</span>
<span class="s2">-s &quot;actor.property.representation = &#39;p&#39;&quot; </span><span class="se">\</span>
<span class="s2">-s &quot;actor.property.point_size=2&quot;</span>
</pre></div>
</div>
<p>This one uses a <code class="docutils literal notranslate"><span class="pre">tvtk.GeometryFilter</span></code> to perform extent based clipping of
the parametric surface generated.  Note the specification of the <code class="docutils literal notranslate"><span class="pre">-f</span>
<span class="pre">UserDefined:GeometryFilter</span></code>.  This data is then cleaned using the
<code class="docutils literal notranslate"><span class="pre">tvtk.CleanPolyData</span></code> filter.</p>
<p>Under <a class="reference internal" href="mlab.html#simple-scripting-with-mlab"><span class="std std-ref">mlab</span></a>, the <cite>Userdefined</cite> can be
used to wrap eg a <cite>GeometryFilter</cite> VTK filter with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">filtered_obj = mlab.pipeline.user_defined(obj, filter=&#39;GeometryFilter&#39;)</span>
</pre></div>
</div>
<p>With <a class="reference internal" href="mlab.html#simple-scripting-with-mlab"><span class="std std-ref">mlab</span></a>, the <cite>user_defined</cite>
function can either take as a filter argument the name of the VTK filter
to be used, or an already-instanciated instance of the filter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">With the <cite>UserDefined</cite> filter, as with most Mayavi filter, the raw
TVTK object can be accessed as the <cite>filter</cite> attribute of the Mayavi
filter object.</p>
</div>
<p>The <a class="reference internal" href="auto/example_image_cursor_filter.html#example-image-cursor-filter"><span class="std std-ref">Image cursor filter example</span></a> gives a full example of using the
UserDefined filter. The <a class="reference internal" href="auto/example_tvtk_segmentation.html#example-tvtk-segmentation"><span class="std std-ref">Tvtk segmentation example</span></a> is a full
example of building a complex VTK pipeline with a heavy use of the
UserDefined filter.</p>
</div>
<div class="section" id="sharing-the-same-data-between-scenes">
<span id="sharing-data-between-scenes"></span><h2>Sharing the same data between scenes<a class="headerlink" href="#sharing-the-same-data-between-scenes" title="Permalink to this headline">¶</a></h2>
<p>If you want to display different views of the same data on different, you
will have to create different Mayavi data sources, as a data source can
belong on to one scene. However, this does not mean that you need to copy
the data, or recreate the source from scratch. The trick is to create a
second Mayavi data source pointing to the same underlying VTK dataset,
and attach it to another scene (see <a class="reference internal" href="data.html#data-structures-used-by-mayavi"><span class="std std-ref">Data representation in Mayavi</span></a>
for the difference between a Mayavi source and a VTK dataset).</p>
<div class="section" id="using-mlab">
<h3>Using mlab<a class="headerlink" href="#using-mlab" title="Permalink to this headline">¶</a></h3>
<p>Every visualization object returned by <a class="reference internal" href="mlab.html#simple-scripting-with-mlab"><span class="std std-ref">mlab</span></a> has a <cite>mlab_source</cite> attribute, which
exposes the VTK dataset as <cite>dataset</cite>. In addition, the <a class="reference internal" href="mlab_pipeline.html#controlling-the-pipeline-with-mlab-scripts"><span class="std std-ref">mlab
pipeline</span></a> functions for
adding modules know how to use raw VTK datasets. Thus exposing the
dataset in a new figure can simply by done by feeding the
<cite>mlab_source.dataset</cite> attribute of a visualization object created by mlab
to an <cite>mlab.pipeline</cite> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">ctr = mlab.test_contour3d()</span>
<span class="s2">mlab.figure()</span>
<span class="s2">ipw = mlab.pipeline.image_plane_widget(ctr.mlab_source.dataset)</span>
<span class="s2">mlab.show()</span>
</pre></div>
</div>
<p>The above example creates two figures displaying the same data, one with
iso-surfaces, and the other with an image plane widget.</p>
<p>Alternatively, it can be useful to be explicit about the figure that the
new module is added onto, rather than using the <cite>mlab</cite> current figure.
This is important to make the code easier to read in situations where the
current figure is not clear, for instance in an interactive application,
rather than a script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">new_fig = mlab.figure()</span>
<span class="s2">ipw = mlab.pipeline.image_plane_widget(ctr.mlab_source.dataset, figure=new_fig)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="auto/example_volume_slicer.html#example-volume-slicer"><span class="std std-ref">Volume slicer example</span></a> shows a complex dialog exposing the same
data through different views via <cite>mlab.pipeline</cite>.</p>
</div>
<div class="section" id="using-the-core-mayavi-api">
<h3>Using the core Mayavi API<a class="headerlink" href="#using-the-core-mayavi-api" title="Permalink to this headline">¶</a></h3>
<p>You can also do this fully explicitly by creating the objects yourself
through the Mayavi core api, and adding them to the pipeline, rather than
using factories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">import numpy as np</span>
<span class="s2">a = np.random.random((3, 3, 3))</span>
<span class="s2">from mayavi.sources.api import ArraySource, VTKDataSource</span>
<span class="s2">src1 = ArraySource(scalar_data=a)</span>
<span class="s2">engine.add_source(src1)</span>
<span class="s2">engine.new_scene()</span>
<span class="s2">scene2 = engine.current_scene</span>

<span class="s2"># Now create a second data source viewing the same data:</span>
<span class="s2">src2 = VTKDataSource(data=src1.image_data)</span>
<span class="s2">scene2.add_child(src2)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="changing-the-interaction-with-a-scene">
<h2>Changing the interaction with a scene<a class="headerlink" href="#changing-the-interaction-with-a-scene" title="Permalink to this headline">¶</a></h2>
<p>The default 3D interaction with the scene (left click on the background
rotates the scene, right click scales, middle click pans) is not suited
for every visualization. For instance, in can be interesting to restrict
the movement to 2D, e.g. when viewing an object in the ‘x’ direction.
This is done by changing the <cite>interactor_style</cite> of a scene. Here is an
example to use Mayavi as a 2D image viewer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">mlab.test_imshow()</span>
<span class="s2">mlab.view(0, 0)</span>
<span class="s2">fig = mlab.gcf()</span>
<span class="s2">from tvtk.api import tvtk</span>
<span class="s2">fig.scene.interactor.interactor_style = tvtk.InteractorStyleImage()</span>
<span class="s2">mlab.show()</span>
</pre></div>
</div>
<p>Another useful interactor is the ‘terrain’ interactor, handy to have
natural movement in scenes where you want the ‘up’ vector to be always
pointing in the ‘z’ direction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi import mlab</span>
<span class="s2">mlab.test_surf()</span>
<span class="s2">fig = mlab.gcf()</span>
<span class="s2">from tvtk.api import tvtk</span>
<span class="s2">fig.scene.interactor.interactor_style = tvtk.InteractorStyleTerrain()</span>
<span class="s2">mlab.show()</span>
</pre></div>
</div>
<p>VTK has many different interactors. An easy way to list them is to
display the VTK class browser (via the help menu, in the <cite>mayavi2</cite>
application) and to search for “Interactor”. Another option is to tab
complete on Ipython, on <cite>tvtk.InteractorStyle</cite>.</p>
</div>
<div class="section" id="accelerating-a-mayavi-script">
<span id="acceleration-mayavi-scripts"></span><h2>Accelerating a Mayavi script<a class="headerlink" href="#accelerating-a-mayavi-script" title="Permalink to this headline">¶</a></h2>
<p>You’ve just created a nice Mayavi/mlab script and now want to generate
an animation or a series of images.  You realize that it is way too slow
rendering the images and takes ages to finish.  There are two simple
ways to speed up the rendering.  Let’s assume that <code class="docutils literal notranslate"><span class="pre">obj</span></code> is any Mayavi
pipeline object that has a <code class="docutils literal notranslate"><span class="pre">scene</span></code> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">obj.scene.disable_render = True</span>
<span class="s2"># Do all your scripting that takes ages.</span>
<span class="s2"># ...</span>
<span class="s2"># Once done, do the following:</span>
<span class="s2">obj.scene.disable_render = False</span>
</pre></div>
</div>
<p>This will speed things up for complex visualizations sometimes by an
order of magnitude.</p>
<p>While saving the visualization to an image you can speed up the image
generation at the cost of loosing out on anti-aliasing by doing the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">obj.scene.anti_aliasing_frames = 0</span>
</pre></div>
</div>
<p>The default value is typically 8 and the rendered image will be nicely
anti-aliased.  Setting it to zero will not produce too much difference
in the rendered image but any smooth lines will now appear slightly
jagged. However, the rendering will be much faster.  So if this is
acceptable (try it) this is a mechanism to speed up the generation of
images.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/mayavi-logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tips and Tricks</a><ul>
<li><a class="reference internal" href="#using-mayavi-in-jupyter-notebooks">Using Mayavi in Jupyter notebooks</a></li>
<li><a class="reference internal" href="#off-screen-rendering">Off screen rendering</a><ul>
<li><a class="reference internal" href="#avoiding-the-rendering-window">Avoiding the rendering window</a></li>
<li><a class="reference internal" href="#platform-summary">Platform Summary</a></li>
<li><a class="reference internal" href="#rendering-using-the-virtual-framebuffer">Rendering using the virtual framebuffer</a></li>
<li><a class="reference internal" href="#using-vtk-with-mesa-for-pure-software-rendering">Using VTK with Mesa for pure software rendering</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extending-mayavi-with-customizations">Extending Mayavi with customizations</a></li>
<li><a class="reference internal" href="#customizing-mayavi2">Customizing Mayavi2</a></li>
<li><a class="reference internal" href="#scripting-mayavi-without-using-envisage">Scripting Mayavi without using Envisage</a></li>
<li><a class="reference internal" href="#computing-in-a-thread">Computing in a thread</a></li>
<li><a class="reference internal" href="#polling-a-file-and-auto-updating-mayavi">Polling a file and auto-updating Mayavi</a></li>
<li><a class="reference internal" href="#serving-mayavi-on-the-network">Serving Mayavi on the network</a><ul>
<li><a class="reference internal" href="#tcp-server-the-serve-tcp-function">TCP server: the <cite>serve_tcp</cite> function</a></li>
<li><a class="reference internal" href="#udp-server-the-serve-udp-function">UDP server: the <cite>serve_udp</cite> function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#animating-a-timeseries">Animating a timeseries</a></li>
<li><a class="reference internal" href="#animating-a-visualization">Animating a visualization</a><ul>
<li><a class="reference internal" href="#creating-a-movie-from-an-animation">Creating a movie from an animation</a></li>
<li><a class="reference internal" href="#animating-a-series-of-images">Animating a series of images</a></li>
<li><a class="reference internal" href="#making-movies-from-a-stack-of-images">Making movies from a stack of images</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scripting-from-the-command-line">Scripting from the command line</a></li>
<li><a class="reference internal" href="#texture-mapping-actors">Texture mapping actors</a></li>
<li><a class="reference internal" href="#shifting-data-and-plotting">Shifting data and plotting</a></li>
<li><a class="reference internal" href="#using-the-userdefined-filter">Using the <code class="docutils literal notranslate"><span class="pre">UserDefined</span></code> filter</a></li>
<li><a class="reference internal" href="#sharing-the-same-data-between-scenes">Sharing the same data between scenes</a><ul>
<li><a class="reference internal" href="#using-mlab">Using mlab</a></li>
<li><a class="reference internal" href="#using-the-core-mayavi-api">Using the core Mayavi API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changing-the-interaction-with-a-scene">Changing the interaction with a scene</a></li>
<li><a class="reference internal" href="#accelerating-a-mayavi-script">Accelerating a Mayavi script</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="building_applications.html"
                        title="previous chapter">Building applications using Mayavi</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="misc.html"
                        title="next chapter">Miscellaneous</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tips.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="misc.html" title="Miscellaneous"
             >next</a> |</li>
        <li class="right" >
          <a href="building_applications.html" title="Building applications using Mayavi"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mayavi 4.6.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2018, Enthought Inc..
      Last updated on Aug 08, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.1.
    </div>
  </body>
</html>