
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Volume slicer example &#8212; mayavi 4.6.1 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Coil design application example" href="example_coil_design_application.html" />
    <link rel="prev" title="Lorenz ui example" href="example_lorenz_ui.html" />
<style type="text/css">
  body {
    /* Very bottom copyright, etc. info */
    background: #4d598d;
  }

  .documentwrapper {
    /* Blank area on left bar */
    background: #24326e;
  }

  .related {
    /* Long horizontal nav bars */
    background: #3c4b8a!important;
  }

  .sphinxsidebarwrapper {
    /* Filled part of left sidebar */
    background: #24326e;
  }

  a {
    color: #253370;
  }

  .sphinxsidebarwrapper a {
    color: #f2f2f2!important;
  }
</style>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example_coil_design_application.html" title="Coil design application example"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="example_lorenz_ui.html" title="Lorenz ui example"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mayavi 4.6.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="examples.html" accesskey="U">Example gallery</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="volume-slicer-example">
<span id="example-volume-slicer"></span><h1>Volume slicer example<a class="headerlink" href="#volume-slicer-example" title="Permalink to this headline">¶</a></h1>
<p>Example of an elaborate dialog showing a multiple views on the same data, with
3 cuts synchronized.</p>
<p>This example shows how to have multiple views on the same data, how to
embedded multiple scenes in a dialog, and the caveat in populating them
with data, as well as how to add some interaction logic on an
ImagePlaneWidget.</p>
<p>The order in which things happen in this example is important, and it is
easy to get it wrong. First of all, many properties of the visualization
objects cannot be changed if there is not a scene created to view them.
This is why we put a lot of the visualization logic in the callback of
scene.activated, which is called after creation of the scene.
Second, default values created via the ‘_xxx_default’ callback are created
lazyly, that is, when the attributes are accessed. As the establishement
of the VTK pipeline can depend on the order in which it is built, we
trigger these access by explicitely calling the attributes.
In particular, properties like scene background color, or interaction
properties cannot be set before the scene is activated.</p>
<p>The same data is exposed in the different scenes by sharing the VTK
dataset between different Mayavi data sources. See
the <a class="reference internal" href="../tips.html#sharing-data-between-scenes"><span class="std std-ref">Sharing the same data between scenes</span></a> tip for more details.</p>
<p>In this example, the interaction with the scene and the various elements
on it is strongly simplified by turning off interaction, and choosing
specific scene interactor styles. Indeed, non-technical users can be
confused with too rich interaction.</p>
<p><strong>Python source code:</strong> <a class="reference download internal" href="../_downloads/volume_slicer.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">volume_slicer.py</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2"># Author: Gael Varoquaux &lt;gael.varoquaux@normalesup.org&gt;</span>
<span class="s2"># Copyright (c) 2009, Enthought, Inc.</span>
<span class="s2"># License: BSD Style.</span>

<span class="s2">import numpy as np</span>

<span class="s2">from traits.api import HasTraits, Instance, Array, </span><span class="se">\</span>
<span class="s2">    on_trait_change</span>
<span class="s2">from traitsui.api import View, Item, HGroup, Group</span>

<span class="s2">from tvtk.api import tvtk</span>
<span class="s2">from tvtk.pyface.scene import Scene</span>

<span class="s2">from mayavi import mlab</span>
<span class="s2">from mayavi.core.api import PipelineBase, Source</span>
<span class="s2">from mayavi.core.ui.api import SceneEditor, MayaviScene, </span><span class="se">\</span>
<span class="s2">                                MlabSceneModel</span>

<span class="s2">################################################################################</span>
<span class="s2"># Create some data</span>
<span class="s2">x, y, z = np.ogrid[-5:5:64j, -5:5:64j, -5:5:64j]</span>
<span class="s2">data = np.sin(3*x)/x + 0.05*z**2 + np.cos(3*y)</span>

<span class="s2">################################################################################</span>
<span class="s2"># The object implementing the dialog</span>
<span class="s2">class VolumeSlicer(HasTraits):</span>
<span class="s2">    # The data to plot</span>
<span class="s2">    data = Array()</span>

<span class="s2">    # The 4 views displayed</span>
<span class="s2">    scene3d = Instance(MlabSceneModel, ())</span>
<span class="s2">    scene_x = Instance(MlabSceneModel, ())</span>
<span class="s2">    scene_y = Instance(MlabSceneModel, ())</span>
<span class="s2">    scene_z = Instance(MlabSceneModel, ())</span>

<span class="s2">    # The data source</span>
<span class="s2">    data_src3d = Instance(Source)</span>

<span class="s2">    # The image plane widgets of the 3D scene</span>
<span class="s2">    ipw_3d_x = Instance(PipelineBase)</span>
<span class="s2">    ipw_3d_y = Instance(PipelineBase)</span>
<span class="s2">    ipw_3d_z = Instance(PipelineBase)</span>

<span class="s2">    _axis_names = dict(x=0, y=1, z=2)</span>


<span class="s2">    #---------------------------------------------------------------------------</span>
<span class="s2">    def __init__(self, **traits):</span>
<span class="s2">        super(VolumeSlicer, self).__init__(**traits)</span>
<span class="s2">        # Force the creation of the image_plane_widgets:</span>
<span class="s2">        self.ipw_3d_x</span>
<span class="s2">        self.ipw_3d_y</span>
<span class="s2">        self.ipw_3d_z</span>


<span class="s2">    #---------------------------------------------------------------------------</span>
<span class="s2">    # Default values</span>
<span class="s2">    #---------------------------------------------------------------------------</span>
<span class="s2">    def _data_src3d_default(self):</span>
<span class="s2">        return mlab.pipeline.scalar_field(self.data,</span>
<span class="s2">                            figure=self.scene3d.mayavi_scene)</span>

<span class="s2">    def make_ipw_3d(self, axis_name):</span>
<span class="s2">        ipw = mlab.pipeline.image_plane_widget(self.data_src3d,</span>
<span class="s2">                        figure=self.scene3d.mayavi_scene,</span>
<span class="s2">                        plane_orientation=&#39;</span><span class="si">%s</span><span class="s2">_axes&#39; % axis_name)</span>
<span class="s2">        return ipw</span>

<span class="s2">    def _ipw_3d_x_default(self):</span>
<span class="s2">        return self.make_ipw_3d(&#39;x&#39;)</span>

<span class="s2">    def _ipw_3d_y_default(self):</span>
<span class="s2">        return self.make_ipw_3d(&#39;y&#39;)</span>

<span class="s2">    def _ipw_3d_z_default(self):</span>
<span class="s2">        return self.make_ipw_3d(&#39;z&#39;)</span>


<span class="s2">    #---------------------------------------------------------------------------</span>
<span class="s2">    # Scene activation callbaks</span>
<span class="s2">    #---------------------------------------------------------------------------</span>
<span class="s2">    @on_trait_change(&#39;scene3d.activated&#39;)</span>
<span class="s2">    def display_scene3d(self):</span>
<span class="s2">        outline = mlab.pipeline.outline(self.data_src3d,</span>
<span class="s2">                        figure=self.scene3d.mayavi_scene,</span>
<span class="s2">                        )</span>
<span class="s2">        self.scene3d.mlab.view(40, 50)</span>
<span class="s2">        # Interaction properties can only be changed after the scene</span>
<span class="s2">        # has been created, and thus the interactor exists</span>
<span class="s2">        for ipw in (self.ipw_3d_x, self.ipw_3d_y, self.ipw_3d_z):</span>
<span class="s2">            # Turn the interaction off</span>
<span class="s2">            ipw.ipw.interaction = 0</span>
<span class="s2">        self.scene3d.scene.background = (0, 0, 0)</span>
<span class="s2">        # Keep the view always pointing up</span>
<span class="s2">        self.scene3d.scene.interactor.interactor_style = </span><span class="se">\</span>
<span class="s2">                                 tvtk.InteractorStyleTerrain()</span>


<span class="s2">    def make_side_view(self, axis_name):</span>
<span class="s2">        scene = getattr(self, &#39;scene_</span><span class="si">%s</span><span class="s2">&#39; % axis_name)</span>

<span class="s2">        # To avoid copying the data, we take a reference to the</span>
<span class="s2">        # raw VTK dataset, and pass it on to mlab. Mlab will create</span>
<span class="s2">        # a Mayavi source from the VTK without copying it.</span>
<span class="s2">        # We have to specify the figure so that the data gets</span>
<span class="s2">        # added on the figure we are interested in.</span>
<span class="s2">        outline = mlab.pipeline.outline(</span>
<span class="s2">                            self.data_src3d.mlab_source.dataset,</span>
<span class="s2">                            figure=scene.mayavi_scene,</span>
<span class="s2">                            )</span>
<span class="s2">        ipw = mlab.pipeline.image_plane_widget(</span>
<span class="s2">                            outline,</span>
<span class="s2">                            plane_orientation=&#39;</span><span class="si">%s</span><span class="s2">_axes&#39; % axis_name)</span>
<span class="s2">        setattr(self, &#39;ipw_</span><span class="si">%s</span><span class="s2">&#39; % axis_name, ipw)</span>

<span class="s2">        # Synchronize positions between the corresponding image plane</span>
<span class="s2">        # widgets on different views.</span>
<span class="s2">        ipw.ipw.sync_trait(&#39;slice_position&#39;,</span>
<span class="s2">                            getattr(self, &#39;ipw_3d_</span><span class="si">%s</span><span class="s2">&#39;% axis_name).ipw)</span>

<span class="s2">        # Make left-clicking create a crosshair</span>
<span class="s2">        ipw.ipw.left_button_action = 0</span>
<span class="s2">        # Add a callback on the image plane widget interaction to</span>
<span class="s2">        # move the others</span>
<span class="s2">        def move_view(obj, evt):</span>
<span class="s2">            position = obj.GetCurrentCursorPosition()</span>
<span class="s2">            for other_axis, axis_number in self._axis_names.items():</span>
<span class="s2">                if other_axis == axis_name:</span>
<span class="s2">                    continue</span>
<span class="s2">                ipw3d = getattr(self, &#39;ipw_3d_</span><span class="si">%s</span><span class="s2">&#39; </span><span class="si">% o</span><span class="s2">ther_axis)</span>
<span class="s2">                ipw3d.ipw.slice_position = position[axis_number]</span>

<span class="s2">        ipw.ipw.add_observer(&#39;InteractionEvent&#39;, move_view)</span>
<span class="s2">        ipw.ipw.add_observer(&#39;StartInteractionEvent&#39;, move_view)</span>

<span class="s2">        # Center the image plane widget</span>
<span class="s2">        ipw.ipw.slice_position = 0.5*self.data.shape[</span>
<span class="s2">                    self._axis_names[axis_name]]</span>

<span class="s2">        # Position the view for the scene</span>
<span class="s2">        views = dict(x=( 0, 90),</span>
<span class="s2">                     y=(90, 90),</span>
<span class="s2">                     z=( 0,  0),</span>
<span class="s2">                     )</span>
<span class="s2">        scene.mlab.view(*views[axis_name])</span>
<span class="s2">        # 2D interaction: only pan and zoom</span>
<span class="s2">        scene.scene.interactor.interactor_style = </span><span class="se">\</span>
<span class="s2">                                 tvtk.InteractorStyleImage()</span>
<span class="s2">        scene.scene.background = (0, 0, 0)</span>


<span class="s2">    @on_trait_change(&#39;scene_x.activated&#39;)</span>
<span class="s2">    def display_scene_x(self):</span>
<span class="s2">        return self.make_side_view(&#39;x&#39;)</span>

<span class="s2">    @on_trait_change(&#39;scene_y.activated&#39;)</span>
<span class="s2">    def display_scene_y(self):</span>
<span class="s2">        return self.make_side_view(&#39;y&#39;)</span>

<span class="s2">    @on_trait_change(&#39;scene_z.activated&#39;)</span>
<span class="s2">    def display_scene_z(self):</span>
<span class="s2">        return self.make_side_view(&#39;z&#39;)</span>


<span class="s2">    #---------------------------------------------------------------------------</span>
<span class="s2">    # The layout of the dialog created</span>
<span class="s2">    #---------------------------------------------------------------------------</span>
<span class="s2">    view = View(HGroup(</span>
<span class="s2">                  Group(</span>
<span class="s2">                       Item(&#39;scene_y&#39;,</span>
<span class="s2">                            editor=SceneEditor(scene_class=Scene),</span>
<span class="s2">                            height=250, width=300),</span>
<span class="s2">                       Item(&#39;scene_z&#39;,</span>
<span class="s2">                            editor=SceneEditor(scene_class=Scene),</span>
<span class="s2">                            height=250, width=300),</span>
<span class="s2">                       show_labels=False,</span>
<span class="s2">                  ),</span>
<span class="s2">                  Group(</span>
<span class="s2">                       Item(&#39;scene_x&#39;,</span>
<span class="s2">                            editor=SceneEditor(scene_class=Scene),</span>
<span class="s2">                            height=250, width=300),</span>
<span class="s2">                       Item(&#39;scene3d&#39;,</span>
<span class="s2">                            editor=SceneEditor(scene_class=MayaviScene),</span>
<span class="s2">                            height=250, width=300),</span>
<span class="s2">                       show_labels=False,</span>
<span class="s2">                  ),</span>
<span class="s2">                ),</span>
<span class="s2">                resizable=True,</span>
<span class="s2">                title=&#39;Volume Slicer&#39;,</span>
<span class="s2">                )</span>


<span class="s2">m = VolumeSlicer(data=data)</span>
<span class="s2">m.configure_traits()</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/mayavi-logo.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="example_lorenz_ui.html"
                        title="previous chapter">Lorenz ui example</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="example_coil_design_application.html"
                        title="next chapter">Coil design application example</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/auto/example_volume_slicer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example_coil_design_application.html" title="Coil design application example"
             >next</a> |</li>
        <li class="right" >
          <a href="example_lorenz_ui.html" title="Lorenz ui example"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">mayavi 4.6.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="examples.html" >Example gallery</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2018, Enthought Inc..
      Last updated on Aug 08, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.1.
    </div>
  </body>
</html>