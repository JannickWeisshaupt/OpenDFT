
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Building applications using Mayavi &#8212; mayavi 4.6.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tips and Tricks" href="tips.html" />
    <link rel="prev" title="Advanced Scripting with Mayavi" href="advanced_scripting.html" />
<style type="text/css">
  body {
    /* Very bottom copyright, etc. info */
    background: #4d598d;
  }

  .documentwrapper {
    /* Blank area on left bar */
    background: #24326e;
  }

  .related {
    /* Long horizontal nav bars */
    background: #3c4b8a!important;
  }

  .sphinxsidebarwrapper {
    /* Filled part of left sidebar */
    background: #24326e;
  }

  a {
    color: #253370;
  }

  .sphinxsidebarwrapper a {
    color: #f2f2f2!important;
  }
</style>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tips.html" title="Tips and Tricks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="advanced_scripting.html" title="Advanced Scripting with Mayavi"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mayavi 4.6.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-applications-using-mayavi">
<span id="builing-applications"></span><h1>Building applications using Mayavi<a class="headerlink" href="#building-applications-using-mayavi" title="Permalink to this headline">¶</a></h1>
<div class="topic">
<p class="topic-title first">Section summary</p>
<p>This section describes how Mayavi can be used as a scientific data
visualization and 3D plotting tool in interactive application.</p>
</div>
<p>Mayavi can be used as a fully integrated and interactive 3D plotting tool
in a GUI application. Using the event model behind Traits and TVTK, all
the different properties of a visualization can be changed dynamically,
including the data visualized itself.</p>
<p>In this section, we first show how an interactive dialog embedding a
Mayavi scene can be built, using <cite>Traits</cite>. Then we show how to integrate
this dialog in a WxPython or a PyQt (or PySide) application.</p>
<div class="section" id="custom-interactive-dialogs">
<h2>Custom interactive dialogs<a class="headerlink" href="#custom-interactive-dialogs" title="Permalink to this headline">¶</a></h2>
<p>Mayavi and TVTK are entirely built using the Traits library which provides
easy callbacks and visualization for objects attribute. All the different
properties of the pipeline and pipeline objects are expressed as Traits,
i.e. special attributes that can be visualized in dialogs and that fire
callbacks when they are modified. In particular this means that when a
visualization object is modified, the scene can update automatically.</p>
<p>We strongly suggest that you refer to the <cite>Traits</cite>
<a class="reference external" href="http://docs.enthought.com/traits">documentation</a>
for more details.  There are also a list of introductory
<cite>materials &lt;https://support.enthought.com/hc/en-us/articles/204469620-Introductory-materials-for-Traits-and-Traits-UI&gt;</cite>
for learning Traits and Traits UI.</p>
<div class="section" id="embedding-a-mayavi-scene-in-a-traits-dialog">
<span id="embedding-mayavi-traits"></span><h3>Embedding a Mayavi scene in a Traits dialog<a class="headerlink" href="#embedding-a-mayavi-scene-in-a-traits-dialog" title="Permalink to this headline">¶</a></h3>
<p>To build a custom dialog with a Mayavi scene, the best option is to
create a class deriving from the base <cite>Traits</cite> class. A special
attribute, called SceneModel can be used as an attribute to represent a
Mayavi scene that can accept objects. This defines the <cite>model</cite>, i.e. the
main <cite>HasTraits</cite> object in which the application logics is contained.</p>
<p>A view of this object, as a dialog, can be created using the
<cite>.configure_traits</cite> method of this object. If a view is explicitely
specified the embedded Mayavi scene can be represented with the usual
widget for scene by specifying for it the <cite>SceneEditor</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Instance</span>
<span class="s2">from traitsui.api import View, Item</span>
<span class="s2">from tvtk.pyface.scene_model import SceneModel</span>
<span class="s2">from tvtk.pyface.scene_editor import SceneEditor</span>

<span class="s2">class MyModel(HasTraits):</span>
<span class="s2">    scene = Instance(SceneModel, ())</span>

<span class="s2">    view = View(Item(&#39;scene&#39;, height=400, show_label=False,</span>
<span class="s2">                    editor=SceneEditor()))</span>

<span class="s2">MyModel().configure_traits()</span>
</pre></div>
</div>
<p>A <cite>Mayavi</cite> button to pop up the pipeline dialog can be added on the
toolbar by specifying a different scene view to the <cite>SceneEditor</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from mayavi.core.ui.mayavi_scene import MayaviScene</span>

<span class="s2">#...</span>
<span class="s2">editor=SceneEditor(scene_class=MayaviScene)</span>
<span class="s2">#...</span>
</pre></div>
</div>
<p>If, on the contrary, you want a view with no toolbar, you can replace the
<cite>MayaviView</cite> by a raw tvtk view:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from tvtk.pyface.api import Scene</span>

<span class="s2">#...</span>
<span class="s2">editor=SceneEditor(scene_class=Scene)</span>
<span class="s2">#...</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="auto/example_mayavi_traits_ui.html#example-mayavi-traits-ui"><span class="std std-ref">Mayavi traits ui example</span></a> is a fairly comprehensive example that
demonstrates how you can embed almost the entire Mayavi UI into your traits
based UI.</p>
</div>
<div class="section" id="a-scene-with-mlab-embedded">
<h3>A scene, with <cite>mlab</cite> embedded<a class="headerlink" href="#a-scene-with-mlab-embedded" title="Permalink to this headline">¶</a></h3>
<p>An object representing a scene is interesting only if you can visualize
data with the scene. For this we can instanciate an <cite>Engine</cite> and assign
it to the scene. Having an <cite>Engine</cite> only for one scene allows us to
confine action and visualization objects only to this scene.</p>
<p>We can also use an <cite>MlabSceneModel</cite> instance, rather than a <cite>SceneModel</cite>,
imported from <cite>mayavi.tools.mlab_scene_model</cite>. This scene model
registers the figure in <cite>mlab</cite> (<a class="reference internal" href="mlab.html#simple-scripting-with-mlab"><span class="std std-ref">mlab: Python scripting for 3D plotting</span></a>). It
has an embedded mlab attribute, that exposes the mlab commands (see
<a class="reference internal" href="mlab_3d_plotting_functions.html#mlab-plotting-functions"><span class="std std-ref">3D Plotting functions for numpy arrays</span></a>). For instance plotting 3D points can be
achieved with <cite>self.scene.mlab.points3d(x, y, z, s)</cite>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Embedding several scenes in an application</p>
<p>When using several ‘MlabSceneModel’ in an application, there is an
ambiguity regarding which scene mlab should use to plot to. This is
why relying on using the current figure, as mlab most often does, is
dangerous.</p>
<p>The solution to this, is explicitly pass in the Mayavi figure to
mlab’s figure keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">mlab.points3d(x, y, z, s, figure=self.scene.mayavi_scene)</span>
</pre></div>
</div>
<p>However, this functionality is new in Mayavi 3.2.1.</p>
<p>A full example with two embedded scenes is given on
<a class="reference internal" href="auto/example_multiple_mlab_scene_models.html#example-multiple-mlab-scene-models"><span class="std std-ref">Multiple mlab scene models example</span></a>.</p>
<p class="last">Another way of creating isolation between scene is to explicitly
insert them in different engines. This is demonstrated in
<a class="reference internal" href="auto/example_multiple_engines.html#example-multiple-engines"><span class="std std-ref">Multiple engines example</span></a></p>
</div>
</div>
<div class="section" id="making-the-visualization-live">
<h3>Making the visualization live<a class="headerlink" href="#making-the-visualization-live" title="Permalink to this headline">¶</a></h3>
<p>Having an interactive application is interesting only if you can do
custom, domain-specific, interaction with the visualization.</p>
<p>An important use case is modifying the data visualized as a parameter is
changed interactively. For this we can use the inplace modification of
the data of an mlab object, as for animation of an mlab plot (see
<a class="reference internal" href="mlab_animating.html#mlab-animating-data"><span class="std std-ref">Animating the data</span></a>). Suppose we are plotting a line curve defined
by a function of two parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from numpy import linspace, pi, cos, sin</span>

<span class="s2">def curve(n_mer, n_long):</span>
<span class="s2">    phi = linspace(0, 2*pi, 2000)</span>
<span class="s2">    return [ cos(phi*n_mer) * (1 + 0.5*cos(n_long*phi)),</span>
<span class="s2">            sin(phi*n_mer) * (1 + 0.5*cos(n_long*phi)),</span>
<span class="s2">            0.5*sin(n_long*phi),</span>
<span class="s2">            sin(phi*n_mer)]</span>
</pre></div>
</div>
<p>Using <cite>mlab</cite>, we could plot the curve with <cite>plot3d</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">x, y, z, s = curve(4, 6)</span>
<span class="s2">from mayavi import mlab</span>
<span class="s2">plot = mlab.plot3d(x, y, z, s)</span>
</pre></div>
</div>
<p>Modifying the plot for new parameters could be written:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">x, y, z, t = curve(4, 8)</span>
<span class="s2">plot.mlab_source.trait_set(x=x, y=y, z=z, scalars=t)</span>
</pre></div>
</div>
<p>In a dialog, this would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from traits.api import HasTraits, Range, Instance, </span><span class="se">\</span>
<span class="s2">                    on_trait_change</span>
<span class="s2">from traitsui.api import View, Item, HGroup</span>
<span class="s2">from tvtk.pyface.scene_editor import SceneEditor</span>
<span class="s2">from mayavi.tools.mlab_scene_model import </span><span class="se">\</span>
<span class="s2">                    MlabSceneModel</span>
<span class="s2">from mayavi.core.ui.mayavi_scene import MayaviScene</span>


<span class="s2">class Visualization(HasTraits):</span>
<span class="s2">    meridional = Range(1, 30,  6)</span>
<span class="s2">    transverse = Range(0, 30, 11)</span>
<span class="s2">    scene      = Instance(MlabSceneModel, ())</span>

<span class="s2">    def __init__(self):</span>
<span class="s2">        # Do not forget to call the parent&#39;s __init__</span>
<span class="s2">        HasTraits.__init__(self)</span>
<span class="s2">        x, y, z, t = curve(self.meridional, self.transverse)</span>
<span class="s2">        self.plot = self.scene.mlab.plot3d(x, y, z, t, colormap=&#39;Spectral&#39;)</span>

<span class="s2">    @on_trait_change(&#39;meridional,transverse&#39;)</span>
<span class="s2">    def update_plot(self):</span>
<span class="s2">        x, y, z, t = curve(self.meridional, self.transverse)</span>
<span class="s2">        self.plot.mlab_source.trait_set(x=x, y=y, z=z, scalars=t)</span>


<span class="s2">    # the layout of the dialog created</span>
<span class="s2">    view = View(Item(&#39;scene&#39;, editor=SceneEditor(scene_class=MayaviScene),</span>
<span class="s2">                    height=250, width=300, show_label=False),</span>
<span class="s2">                HGroup(</span>
<span class="s2">                        &#39;_&#39;, &#39;meridional&#39;, &#39;transverse&#39;,</span>
<span class="s2">                    ),</span>
<span class="s2">                )</span>

<span class="s2">visualization = Visualization()</span>
<span class="s2">visualization.configure_traits()</span>
</pre></div>
</div>
<p>This code creates the following dialog:</p>
<img alt="_images/example_mlab_interactive_dialog1.jpg" class="align-center" src="_images/example_mlab_interactive_dialog1.jpg" />
<p>A complete, runnable, code based on the above comments is given in the
<a class="reference internal" href="auto/example_mlab_interactive_dialog.html#example-mlab-interactive-dialog"><span class="std std-ref">Mlab interactive dialog example</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Visualization objects and properties created before a scene is available</p>
<p>When creating a traited object with an embedded scene, the scene can
be created and populated before a view on it is actually open.
However, some VTK objects or properties require a scene with a camera
and interaction to be open to work properly, mainly because either
they orient themselves to the camera, or deal with interaction with
keyboard or mouse (such as interactors, eg an implicit plane). As a
result some property changes on VTK objects will raise warnings or
simply not work when applied without a dialog opened. When embedding
a scene in a Traits object, the best option is to create and modify
these objects only when the scene is activated, by listening to
changes on the ‘scene.activated’ traits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">@on_trait_change(&#39;scene.activated&#39;)</span>
<span class="s2">def create_plot(self):</span>
<span class="s2">    # Do the plotting here</span>
<span class="s2">    # ...</span>
</pre></div>
</div>
<p class="last">The <a class="reference internal" href="auto/example_lorenz_ui.html#example-lorenz-ui"><span class="std std-ref">Lorenz ui example</span></a> shows a good example of this situation.</p>
</div>
<div class="topic">
<p class="topic-title first">Learning by examples</p>
<p>Several full-featured examples can be used to learn more about how to
develop an application with visualization and data processing with Traits
and Mayavi:</p>
<ul class="simple">
<li><a class="reference internal" href="auto/example_lorenz_ui.html#example-lorenz-ui"><span class="std std-ref">Lorenz ui example</span></a>: A didactic and simple example that shows
how the lorenz model can be integrated and visualized interactively
while changing the model parameters.</li>
<li><a class="reference internal" href="auto/example_mayavi_traits_ui.html#example-mayavi-traits-ui"><span class="std std-ref">Mayavi traits ui example</span></a>: An example showing how you can mimic
the UI of the Mayavi application with simple code using Traits.</li>
<li><a class="reference internal" href="auto/example_multiple_engines.html#example-multiple-engines"><span class="std std-ref">Multiple engines example</span></a>: An example showing how you can
isolate different scenes by affecting them to different engines.</li>
<li><a class="reference internal" href="auto/example_coil_design_application.html#example-coil-design-application"><span class="std std-ref">Coil design application example</span></a>: A full-blown and elaborate
application enabling specification of a current-loop description for
a coil, and integration of the resulting magnetic field with real-time
visualization of the field and the coil structure.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="integrating-in-a-wxpython-application">
<h2>Integrating in a WxPython application<a class="headerlink" href="#integrating-in-a-wxpython-application" title="Permalink to this headline">¶</a></h2>
<p>Using the <cite>Visualization</cite> class defined above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">import wx</span>

<span class="s2">class MainWindow(wx.Frame):</span>
<span class="s2">    def __init__(self, parent, id):</span>
<span class="s2">        wx.Frame.__init__(self, parent, id, &#39;Mayavi in Wx&#39;)</span>
<span class="s2">        self.visualization = Visualization()</span>
<span class="s2">        self.control = self.visualization.edit_traits(parent=self,</span>
<span class="s2">                                kind=&#39;subpanel&#39;).control</span>
<span class="s2">        self.Show()</span>

<span class="s2">app = wx.PySimpleApp()</span>
<span class="s2">frame = MainWindow(None, wx.ID_ANY)</span>
<span class="s2">app.MainLoop()</span>
</pre></div>
</div>
<p>Two examples of integrating Mayavi visualization with Wx applications are
given:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="auto/example_wx_embedding.html#example-wx-embedding"><span class="std std-ref">Wx embedding example</span></a>: a simple example, as above.</li>
<li><a class="reference internal" href="auto/example_wx_mayavi_embed_in_notebook.html#example-wx-mayavi-embed-in-notebook"><span class="std std-ref">Wx mayavi embed in notebook example</span></a>: a more complexe example,
showing 2 different Mayavi views embedded in a Wx notebook.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="integrating-in-a-qt-application">
<span id="integrating-pyqt"></span><h2>Integrating in a Qt application<a class="headerlink" href="#integrating-in-a-qt-application" title="Permalink to this headline">¶</a></h2>
<p>Mayavi dialogs can also be integrated in a PyQt or PySide application.</p>
<p>Before defining the <cite>Visualization</cite> class, you should set the toolkit
used by Traits to the Qt backend:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">import os</span>
<span class="s2">os.environ[&#39;ETS_TOOLKIT&#39;] = &#39;qt4&#39;</span>
</pre></div>
</div>
<p>Also, as Traits runs with PyQt and PySide, if you use PyQt, you must make
sure that you swith its binding in a mode that is compatible with PySide
(internal string representation mode), <strong>before you import any PyQt
code</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">import sip</span>
<span class="s2">sip.setapi(&#39;QString&#39;, 2)</span>
</pre></div>
</div>
<p>By default, with modern versions of the Enthought Tool Suite, Traits will
use PySide. To force the use of PyQt, you must set the QT_API environment
variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">os.environ[&#39;QT_API&#39;] = &#39;pyqt&#39;</span>
</pre></div>
</div>
<p>Then using the visualization class defined above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">from PyQt4 import QtGui</span>

<span class="s2">class MainWindow(QtGui.QMainWindow):</span>
<span class="s2">    def __init__(self, parent=None):</span>
<span class="s2">        QtGui.QWidget.__init__(self, parent)</span>
<span class="s2">        self.visualization = Visualization()</span>
<span class="s2">        self.ui = self.visualization.edit_traits().control</span>
<span class="s2">        self.setCentralWidget(self.ui)</span>

<span class="s2">window = MainWindow()</span>
<span class="s2">window.show()</span>
<span class="s2">QtGui.qApp.exec_()</span>
</pre></div>
</div>
<p>For a full-blown example of embedding in Qt, see
<a class="reference internal" href="auto/example_qt_embedding.html#example-qt-embedding"><span class="std std-ref">Qt embedding example</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>On definition of the model (and thus previous to the start of the
event loop), Traits sets up some hooks on the main QApplication. As a
result if you instanciate a new one, using for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">app = QtGui.QApplication()</span>
</pre></div>
</div>
<p class="last">Your Traits application will not work.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/mayavi-logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building applications using Mayavi</a><ul>
<li><a class="reference internal" href="#custom-interactive-dialogs">Custom interactive dialogs</a><ul>
<li><a class="reference internal" href="#embedding-a-mayavi-scene-in-a-traits-dialog">Embedding a Mayavi scene in a Traits dialog</a></li>
<li><a class="reference internal" href="#a-scene-with-mlab-embedded">A scene, with <cite>mlab</cite> embedded</a></li>
<li><a class="reference internal" href="#making-the-visualization-live">Making the visualization live</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integrating-in-a-wxpython-application">Integrating in a WxPython application</a></li>
<li><a class="reference internal" href="#integrating-in-a-qt-application">Integrating in a Qt application</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="advanced_scripting.html"
                        title="previous chapter">Advanced Scripting with Mayavi</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tips.html"
                        title="next chapter">Tips and Tricks</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/building_applications.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tips.html" title="Tips and Tricks"
             >next</a> |</li>
        <li class="right" >
          <a href="advanced_scripting.html" title="Advanced Scripting with Mayavi"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mayavi 4.6.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2018, Enthought Inc..
      Last updated on Aug 08, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.1.
    </div>
  </body>
</html>